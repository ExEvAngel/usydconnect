<!DOCTYPE html>
<html>
	<%# Generate title. %>
	<% provide(:title, @title) %>

	<body>
		<div class="content-outer">
			<div class="content-inner">

				<div class="thread-header">
					<h2><%= @title %></h2>
					<div class="thread-details">
						<% if is_logged_in? %>
							<% if not_following?(@u_id, params[:id]) %>
								<%= button_to('Follow Thread', thread_follow_path(:id => params[:id]), :method => :post, class: "button") %>
							<% else %>
								<%= button_to('Unfollow Thread', thread_unfollow_path(:id => params[:id]), :method => :post, class: "button") %>
							<% end %>
						<% end %>
						<%= link_to @by, profile_path(:id => @thread[0].user_id) %>
						&nbsp&nbsp
						<div class="italic"><%= @time %></div>
					</div>
				</div>

				<div class="thread-content">
					<p class="strong"><%= @body %></p>
					<hr class="thick">
					
					<div class="thread-comments">
						<% if !@comments.nil? %>
							<table class="table-inner">
								<% @comments.find_in_batches(batch_size: 3) do |group| %>
									<% group.each do |c| %>
										<tr>
											<td class="table-name">
												At <%= c.date%> <%= link_to author(c.user_id), profile_path(:id => c.user_id) %> Says:
											</td>
										</tr>
										<tr>
											<td><%= c.body %></td>
										</tr>
									<% end %>			
								<% end %>
							</table>
						<% end %> 
					</div>
					<br>
					<br>
					<% if is_logged_in? %>
						<%= form_tag('/thread/submitc', method: 'post') do %>
							<%= hidden_field_tag "at_id", params[:id] %>
							<%= text_area_tag(:body, "", placeholder: "", class: "text-area-small", maxlength: 500) %>
							<br>
							<br>
							<%= submit_tag("Submit", class: "button") %>
						<% end %>
					<% end %>
				</div>

				<p class="error">
					Need to fix time format and change timezone<br>
					like and unlike comments?
				</p>
			</div>
		</div>
	</body>
</html>
